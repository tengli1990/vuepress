# DNS详解

## 什么是DNS？他的作用是什么？
DNS是Domain Name System,域名系统，用于将域名转换为IP。  

#### 域名分级
域名也分好多种，带www.开头的都是二级域名，一级域名都是不带www. 域名里有几个 . 就是几级域名。com是根域名。

#### 域名资源记录

每一个域名对应一个IP，它叫记录，这个域名就叫域名资源，它们合起来叫做**域名资源记录**。

#### 域名服务器与解析

域名需要解析就需要找服务器，通过服务器进行解析，做解析的服务器就是**域名服务器**。**域名解析**就是把文本转换成IP。

::: warning 
IP 里边的 xxx.xxx.xx.x仍然是个文本，包括IPV6的16进制 xxxx:xx 它仍然是个文本。实际上IP地址是个整数，它是INT类型。整型要占4个字节，在内存里就占4个基本存储空间，这一个空间就是1个字节，一个字节的范围是0-255。这个.就是用来分割空间的。
:::

## 域名的解析过程

它背后不仅仅是一个DNS，它背后有好多服务器。因为域名现在特别多，把这么多域名放在一台服务器上是不现实的。每时每刻有那么多人去查询这个域名，并发量有多大。所以设计出来了分级去维护，设备去访问域名，到了DNS服务器，DNS收到请求之后，优先从本地缓存去找。如果找不到就向根域名服务器查询，根域名只负责维护后缀。全球有13台根域名服务器，中国只有根解析服务器的镜像。DNS要向根域名服务器查询的时候，需要把完整的域名发过去。根服务器把后缀提出来之后，告诉DNS服务器.com这一类的域名向哪个服务器继续查询。服务器再把完整的域名发送给TLD服务器，TLD服务器负责一级域名，TLD查询到这个一级域名归哪个名称服务器去维护，再返回给DNS。DNS服务器再把域名发到名称服务器上，名称才有域名对应的解析。DNS收到这个解析结果之后先放到缓存，然后再返回给访问设备。访问那些不常用的网站，实际是速度会比较慢，因为背后还需要转换三次甚至多次。经常访问的就都放在DNS缓存里边。

![DNS工作流](/dns_workflow.png)

什么样的数据可以进缓存？理论上什么数据都可以进缓存，但是数据是符合业务的这一类数据。有的是有必要，入缓存，有的没必要，有的有必要但是只逗留一部分时间再删掉。究竟谁来决定？缓存维护的算法，它内部最重要的依据是数据命中率。什么是命中率？当去缓存中找的时候，找到了命中率就增加，找不到命中率就减。提高命中率就要动态维护缓存的数据。低频的缓存，过一段时间没有人去解析了，那就把它从缓存中移除了。
访问一级域名也要访问名称服务器，因为一级域名下有可能有二级域名N级域名，那TLD服务器究竟是给返回一级域名IP还是名称服务器IP？？这个没办法分辨，所以访问一级还是要到名称服务器上，只有名称服务器才有对应的真正IP。TLD是来分配名称服务器IP的。
域名资源记录，在DNS解析的时候，域名绑定IP需要配置记录类型，记录类型也分很多种。


| 记录类型 |    含义  |
| ------- | --------|
| SOA     | 起始授权记录，这个由购买域名的公司维护，如果转换公司就由它们公司自己去做 |
| A记录    | 域名对应IP的映射关系，IPV4 |
| AAAA    | IPV6的映射关系  |
| CNAME   | 别名，重定向到别的域名，域名跳转而已 |
| NS记录   | 域名服务器记录，把域名指向自己的名称服务器NameServer |
| MX      | 用于返回接收电子邮件的服务器地址（就是邮箱服务器） |