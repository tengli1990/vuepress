# Docker实战

## 初始化Node程序

浏览localhost:3000 页面显示 Hello Docker

``` shell
mkdir docker_demo
cd docker_demo
# 创建文件
touch server.js
touch package.json
touch Dockerfile
touch .dockerignore
# 安装koa
npm install koa
```

server.js
``` js
const Koa = require('koa');
const app = new Koa();
app.use(async ctx => {
   ctx.body = 'Hello docker';
});
app.listen(3000);
```

然后运行
``` shell
node server.js
```

查看 localhost:3000

## 创建Dockerfile文件

Dockerfile 是由一系列命令和参数构成的脚本，一个Dockerfile里面包含了整个image的完整命令。Docker通过 docker build 执行Dockerfile 中的一系列命令自动构建image. 

#### 在.dockerignore 文件里写入代码。表示过滤该类型的文件，类似.gitignore

``` shell
# Log
logs
*.log
npm-debug.log*
# # Runtime data
pids
*.pid
*.seed
# # Directory for instrumented libs generated by jscoverage/JSCover
lib-cov
# Coverage directory used by tools like istanbul
coverage
# nyc test coverage
.nyc_output
# Grunt intermediate storage (http://gruntjs.com/creating-
plugins#storing-task-files)
.grunt
# node-waf configuration
.lock-wscript
# Compiled binary addons (http://nodejs.org/api/addons.html)
build/Release
# Dependency directories
node_modules
jspm_packages
# Optional npm cache directory
.npm
# Optional REPL history
.node_repl_history
.idea
.node_modules
node_modules
.vscode
```

#### 在Dockerfile写入以下代码

``` shell
#制定node镜像的版本
FROM node:8.9-alpine
#声明作者
MAINTAINER evilboy 
#移动当前⽬目录下⾯面的⽂文件到app⽬目录下 
ADD . /app/ 
#进⼊入到app⽬目录下⾯面，类似cd 
WORKDIR /app
#安装依赖
RUN npm install
#对外暴暴露露的端⼝口
EXPOSE 3000
#程序启动脚本
CMD ["npm", "start"]

```

``` shell
# -p 当我们访问当前环境的3001的时候 就等于访问了docker里面的80端口
# -v 映射文件夹及内容到docker，并使之关联。
docker run --restart always --name centos -p 3001:80 -v /root/docker:/var/www/docker -itd centos:latest
# 进入运行的docker 环境
docker exec -it centos bash
yum install nginx
```

nginx 配置
```
server {
  listen        80;
  server_name   123.56.121.125

  location / {
     root  /var/www;
     index index.html index.htm
  }
}
```
配置nginx并启动 就可以访问了 123.56.121.125:3001



